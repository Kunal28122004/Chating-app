<html>
<head></head>

<meta charset="UTF-8">
<title>Chat App</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 600px;
        margin: 40px auto;
        padding: 20px;
        background-color: #f4f6f8;
        color: #333;
    }

    h2 {
        text-align: center;
        color: #444;
    }

    #messages {
        list-style: none;
        padding: 10px;
        border: 1px solid #ccc;
        background: #fff;
        height: 350px;
        overflow-y: auto;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    #messages li {
        padding: 8px 12px;
        margin-bottom: 6px;
        border-radius: 8px;
        background-color: #e6f0ff;
        word-wrap: break-word;
    }

    #input {
        display: flex;
        margin-top: 15px;
        gap: 10px;
    }

    #messageInput {
        flex: 1;
        padding: 12px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 8px;
        outline: none;
        transition: border 0.3s;
    }

    #messageInput:focus {
        border-color: #007bff;
    }

    #sendBtn {
        padding: 12px 20px;
        font-size: 16px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    #sendBtn:hover {
        background-color: #0056b3;
    }
</style>
</head>

<body>
    <h2>Simple Chat</h2>
    <ul id="messages"></ul>
    <div id="input">
        <input id="messageInput" placeholder="Type your message..." />
        <button id="sendBtn">Send</button>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const username = localStorage.getItem("username");
        if (!username) window.location.href = "login.html";

        const socket = io("http://localhost:8000");

        socket.on("connect", () => {
            console.log("Connected to server");
        });

        socket.on("receive_message", (data) => {
            const li = document.createElement("li");
            li.textContent = `${data.username}: ${data.message}`;
            document.getElementById("messages").appendChild(li);
            autoScroll();
        });

        document.getElementById("sendBtn").addEventListener("click", () => {
            const msgInput = document.getElementById("messageInput");
            const msg = msgInput.value;
            if (msg.trim()) {
                socket.emit("send_message", { username, message: msg });
                msgInput.value = "";
            }
        });

        function autoScroll() {
            const messages = document.getElementById("messages");
            messages.scrollTop = messages.scrollHeight;
        }
    </script>
</body>

</html>